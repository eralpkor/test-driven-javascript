<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  
  <script src="../simpletest.js"></script>
  <script>
    function sort(array, compareFunction) {
      if (array.length === undefined || isNaN(Number(array.length)) || array.length <= 0) {
        array.length = 0;
      } else {
        array.length = Math.floor(array.length);
      }
  
      var copy = Array.prototype.slice.call(array);
      
      //Set array to empty
      Array.prototype.splice.call(array, 0, array.length);
  
      //Take care of holes
      var holesCount = 0;
      for (var m = 0; m < copy.length; m++) {
        if (m in copy === false) {
          holesCount++;
        }
      }
  
      //Take care of undefined
      var undefinedCount = 0;
      for (var n = 0; n < copy.length; n++) {
        if (copy[n] === undefined && (n in copy === true)) {
          undefinedCount++;
        }
      }
  
      for (var j = 0; j < copy.length; j++) {
        if (copy[j] !== undefined) {
          var counter = 0;
  
          for (var k = 0; k < copy.length; k++) {
            if (j !== k && copy[k] !== undefined) {
              if (arguments.length < 2) {
                if (String(copy[j]) > String(copy[k])) {
                  counter++;
                }
              } else {              
                if (compareFunction(Number(copy[j]), Number(copy[k])) > 0) {
                  counter++;
                }
              }
            }
          }
  
          //For numbers with same values or strings with same numeric value
          if (counter in array) {
            counter++;
          }
  
          array[counter] = copy[j];
        }
      }
  
      //add undefineds back
      var len = array.length;
      for (var i = len; i < len + undefinedCount; i++) {
        array[i] = undefined;
      }
  
      //add holes back
      array.length += holesCount;
  
      return array;
    }
  
    tests({
      '1.It should return an array.': function () {
        var result = sort([1, 30, 4, 21]);
        eq(Array.isArray(result), true);
      },
      '2.It should return the same array.': function () {
        var testArray = [1, 2, 3];
        var result = sort(testArray);
        eq(result, testArray);
      },
      '3.It should sort numbers according to string Unicode code point value.': function () {
        var testArray = [1, 30, 4, 21];
        var result = sort(testArray);
        var expected = [1, 21, 30, 4];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '4.It should sort strings according to string Unicode code point value too.': function () {
        var months = ['March', 'Jan', 'Feb', 'Dec'];
        var result = sort(months);
        var expected = ["Dec", "Feb", "Jan", "March"];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '5.It should sort according to string Unicode code point value even when sorting an array with numbers and strings.': function () {
        var mixedArray = ['80', '9', '700', 40, 1, 5, 200];
        var result = sort(mixedArray);
        var expected = [1, 200, 40, 5, "700", "80", "9"];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '6.It should sort undefined elements to the end of the array.': function () {
        var testArray = [1, undefined, 30, 4, undefined, undefined, 21];
        var result = sort(testArray);
        var expected = [1, 21, 30, 4, undefined, undefined, undefined];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '7.It should sort unassigned indexes to the end of the array.': function () {
        var testArray = [, 1, , 2, 3, ,];
        var result = sort(testArray);
        var expected = [1, 2, 3, , , ,];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '8.It should sort undefined before holes.': function () {
        var result = sort([, 3, undefined]);
        eq(result[0], 3);
        eq(result[1], undefined);
        eq(1 in result, true);
        eq(2 in result, false);
      },
      '9.It should accept an optional compareFunction. If compareFunction(a, b) < 0, sort a to an index lower than b.': function () {
        var numbers = [4, 2, 5, 1, 3];
        var result = sort(numbers, function(a, b) {
          return a - b;
        });
        var expected = [1, 2, 3, 4, 5];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '10.If compareFunction(a, b) > 0, sort b to an index lower than a.': function () {
        var numbers = [4, 2, 5, 1, 3];
        var result = sort(numbers, function(a, b) {
          return b - a;
        });
        var expected = [5, 4, 3, 2, 1];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '11.If compareFunction(a, b) = 0, leave a and b unchanged.': function () {
        var numbers = [80, 9, 700, 80, 40, 1];
        var result = sort(numbers, function(a, b) {
          if (a < b) {
            return -1;
          }
          if (a > b) {
            return 1;
          }
          return 0;
        });
        var expected = [1, 9, 40, 80, 80, 700];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '12.With a compare function, it should sort all undefined elements to the end of the array too.': function () {
        var testArray = [4, undefined, 2, undefined, 5, undefined, 1, 3];
        var result = sort(testArray, function(a, b) {
            return a - b;
        });
        var expected = [1, 2, 3, 4, 5, undefined, undefined, undefined];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '13.It should not call the compare function for undefined values.': function () {
        var counter = 0;
        var testArray = [4, undefined, 2, undefined, 5, undefined, 1, 3];
        var result = sort(testArray, function(a, b) {
          counter++;
          return a - b;
        });
        eq(counter, 20);
      },
      '14.If compareFunction, it should convert strings to numbers when comparing them.': function () {
        var mixedArray = ['80', '9', '700', 80, 40, 1, 5, 200];
        var result = sort(mixedArray, function compareNumbers(a, b) {
          return a - b;
        });
        var expected = [1, 5, "9", 40, "80", 80, 200, "700"];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '15.It should sort strings at the earliest possible chance.': function () {
        var mixedArray = ['80', '9', '700', 80, 40, 1, 5, 200];
        var result = sort(mixedArray, function(a, b) {
          if (a < b) {
            return -1;
          }
          if (a > b) {
            return 1;
          }
          return 0;
        });
        //Based on numeric value: [1, 5, "9", 40, "80", 80, 200, "700"]
        //Native sort:
        var expected = [1, 5, "700", "80", "9", 40, 80, 200];
        result.forEach(function (ele, i) {
          eq(ele, expected[i]);
        });
      },
      '16.Array of objects can be sorted, given the values of their properties. Test for numeric.': function () {
        var items = [
          {name: 'Edward', value: 21},
          {name: 'Sharpe', value: 37},
          {name: 'And', value: 45},
          {name: 'The', value: -12},
          {name: 'Magnetic', value: 13},
          {name: 'Zeros', value: 37}
        ];
        // sort by value
        var result = items.sort(function (a, b) {
          return a.value - b.value;
        });
        eq(result[0].value, -12);
        eq(result[1].value, 13);
        eq(result[2].value, 21);
        eq(result[3].value, 37);
        eq(result[4].value, 37);
        eq(result[5].value, 45);
      },
      '17.Array of objects can be sorted, given the values of their properties. Test for string.': function () {
        var items = [
          {name: 'Edward', value: 21},
          {name: 'Sharpe', value: 37},
          {name: 'And', value: 45},
          {name: 'The', value: -12},
          {name: 'Magnetic', value: 13},
          {name: 'Zeros', value: 37}
        ];
        var result = items.sort(function(a, b) {
          var nameA = a.name.toUpperCase(); //ignore upper and lowercase
          var nameB = b.name.toUpperCase(); //ignore upper and lowercase
          if (nameA < nameB) {
            return -1;
          }
          if (nameA > nameB) {
            return 1;
          }
          // names must be equal
          return 0;
        });
        eq(result[0].name, "And");
        eq(result[1].name, "Edward");
        eq(result[2].name, "Magnetic");
        eq(result[3].name, "Sharpe");
        eq(result[4].name, "The");
        eq(result[5].name, "Zeros");
      },
      '18.It should work for an array-like object.': function () {
        var testObject = {
          0: 'March',
          1: 'Jan',
          2: 'Feb',
          3: 'Dec',
          length: 4
        };
        sort(testObject);
        eq(testObject[0], 'Dec');
        eq(testObject[1], 'Feb');
        eq(testObject[2], 'Jan');
        eq(testObject[3], 'March');
      },
      '19.If the length property can not be converted to a number, it should not sort any elements.': function () {
        var testObject = {
          0: 'March',
          1: 'Jan',
          2: 'Feb',
          3: 'Dec',
          length: "I'm an invalid length."
        };
        sort(testObject);
        eq(testObject[0], 'March');
        eq(testObject[1], 'Jan');
        eq(testObject[2], 'Feb');
        eq(testObject[3], 'Dec');
      }
    });
  </script>















</body>
</html>